package net.heberling.ismart.rest;

import static net.heberling.ismart.rest.EncryptionUtils.decryptRequest;
import static net.heberling.ismart.rest.EncryptionUtils.decryptResponse;
import static net.heberling.ismart.rest.EncryptionUtils.encryptRequest;
import static org.junit.jupiter.api.Assertions.*;

import org.junit.jupiter.api.Test;

class EncryptionUtilsTest {

  @Test
  void testEncryptionUtils() {
    String decrypt =
        decryptResponse(
            "1703022132432",
            "application/json",
            "7f09df27c92c5b59dd32298396ab35fd95278ccce1251a35ce29ecd8e91d5567a8527754435f77c429f9bcd91d3a61ea82b19e171bf45195ad98babddbfd32eb41ffab8fb1f585d50cbfef3a0eaaa76f190103381df7385734c568cb8d991c5961d1cccc35b4f37c135849301800ef700418169ab1a88c6badaf6c087a8c9dcd00f598e3bf69b593e18a983cb3dcead1b2c993e06d47536c86a2a9468a236de62cf93931038c2cc0076c74ce479009b5f265ac5fe91dfc0de2d3afa2ef73803537cad3f2dadcf7ba5913669a91f22025df551eb8a7d44a4d559b021aac4379cd865f18f0f8280139bd3e6bb07d9f868d32d65c4c0a9c04a4f65aa117b838b9c0551fec69720ab3e6d6e0d5439b18e686ef939a1ce0fc98ca13d2dd5708559125918617f8ac6064553d4ace7f91c2260aa8542a6f26d4c7e40f874dd509e67035e6f89abc2eb763aea7a2216571b77da5cf59e84be6be3ac2c665db8ae7e711933aebe8e6d4ca81d35b1ab854f1d53079c2382363bc1c4828a77cda3a356cd0373dbcb673d38b28a2c651977c4114834eec55c0875c7457be0f014d0725528e883b7a83ed8ad16444e93eeef54d258a6a67607a35e6ea81085405fd145bd8f73e4df8d35154a2f57ad49111dc6c1e28b72c7a6b84b782e3acd288fa3e9bd56781ff5f36c5e10f37e53e680bc3734f1b535e99e12ecf6a1d9b7299257efc535c90963fb7f3e8470379c51fbc941be3e97e3c2cc31101aca7e730b6072d25a9035f1e452abef623d54c15efac84320a0290e449de2c67fc4e31caaefaf100c02d46f50860d2e721e95bec6ac336cb0b50d55f6309614d9be0359004ac0e50b624af34816feca41679dfdde1add6e181dcf942de944443cf8627dafc65430dac50cc385e3c3e98e99c281a66f90e36192b803314ec6948dafd5e7172b3464b06d8d60d52f6fd22b9e718c6ac0de6b4f86c3694e94338165f6b5a267575b6b8a72ba33b4299e8ddf0ee31f51fce4654074a88e184158ef2c7f277f77f89a48aafc4972401535372189ab721513522793111a8f1adab5656ebbb57f1800391f5db37536616f594e9e0cfd2784a409cddf885972c7365a620c851032cd1e4cda1570f93ba108954c176f945c8114db65d370f52a20ffdb43c47ad32d778c718e19e934acd3d4632b0f28d3b2d743ddae8e011d252406d543cded7ef91573182698a615c74ef7d65fdbc7ed3166b3db1a810067b7a60ab5546ba1560779c4174b229003225fcc2518253aa121475fe268dc29b5627f2c9badd108a11a1569a535d6bab48776ec73d6d01adee98201f35dd5169080a449699f3a6f03b809efd9b326d7ceb3b2c04dc9333d6ddf72fb269ef2a5fba2245a8ebda849a8ae000ef82483f468a53e37fecfe49658e41cb1896c8628c62bd535fc7cb6c2ea8229d91ab9e773c003a4fdd445c8953987a4b648082bac2625ae23df18c209d33c0e19d0a9f0cda5d8314510001a90d0b34c5a5f3d6c0473df47a18f192626ea936d417945e11da72213505538861edc023453707a0600dfd098ce712434ad62d1c13205ea06332ac3205f0de21a8436b0539e0403580c436205e977f1db4b5feb847621e20a186f1af87989b0e5141500cc94738c7dcd2b0d1628672ae5cba19b845f96f68cb934d781ed54c223281222151326af1e2d3abaf46ba9dc83fc428e4d7a11778b228f279c313cc1f3ae3b46cc138d1eae03e305252817610b9a74c67ff4ed1e0a91da0f9eb938001df369edd31b44a590eba2922886157fc3ec6d9ed2aca6d0470d8d066c46de4b36738fd1d517d000dc39e5ab77d49b22b003e323e9d7b32ab3f82f47284ffbdd6d651b5414ac8a0c7492d56032fe504e6acab700f6d6a57d79d6322fd7fa521addfe3982e9f2927d1669740cabc106804c3b31f19aed0b19819b00a5b84cf821d076862440974a1ea6aca140542a24d63bd87db0e199e5f9f43512abc77f7291b060c8f84c8d0ad216540358c3af0f72b0f90f2887c72b0acce4e201521ce15f449b2742b622aef4c3205c4943ed7fbe993b6b28e00fd962ceaadeab1179b1a7696aecdd9fe69cbadea6c8cc95ce90ee56fc4761510713e6d5d9f2649ff3829a7ee60a3202bdc248d3ac11cacb0a8dacc4e8055cf557d427e73d2268bf83f5f91a6906248cc811335187f575d27dc0c2cf9a6870c8ad3dfaa6ac759b6096b7a277b81efff439bc0b366122b238b873560160d687c23005f13f3906f9b0189e89ed98577c8e4087fb27682ba847fa1f714d04624132138997a4133c746f0cb9da62dbb1072defbe69ea94ba2da2f88c0fcaa2873df4f1131170f7a9bd9a723a2131937983ddaa9023ff2ea6a21f6ab0a2eb566387e665efa7077bc614e2b4ebffd6e66f4801d8184225a3bd574ed7db08b939c98cc1fde66af7f7dcae7e046e399b791bf0c4c07304d8beafe42e1d9485517fb0d58560c16a796291041854c99d490d5ccdbf0d40b72d4ed563753343eb994e37f3a9a14a129c818366c8cc6958c157664eca7aa4dd834939e017fc2bfadb7018729ab443bf625cc8b2d529a268609039d8849a84e6c3b37d4acf7f71de99d7ba9d15f2229521eb8fc3b3c5894b94d60bf96f465f1882895f8c3d56992c6518d6cb0875ee370dfba88cfc2d1abab646a32d9e1670421cb17963e052d01171e6d825987c85377efccd4bf58ce0ba92af30181f442200db25c46b7069473093d126032ca3b1c5863beb19faa39de1120c3459dc0ec1107cc090ee31707207a8e91764f5725bceca865aa0801ab2523bec39db61b6598e46253242f793de9459a942833f54ae0e555d322f54618b43886cdbf4a7b1afd0be0a7ba341545e496f5fa25b9bfd558479110ee8acd8e3b1da52e9e59f8a916f065186c548f17d17306d63c843176881484ab3412ac40d807105622bb8afe32ef3dbfada472d3e876adbe9e2bcd660cc13ba8322849dd770b9000c3a999ff366156d242acb6e032e13a615b676dc55c245b02628e4d61862f9e5a60c8b083b227f591943768e7b1ba269e2312dabd870150613ea972cca30ed85928f882d01a910984d74197bdbc106b36028273920536695a52ea9d385df8b601ee7771a4b7ab1f863bba29e22d7e492ab9f008b0b82cc9cc652c9c1b6824e44ffaca9e5c66a2bbd09ecca3133ca3c47b35b04c75da75747ce8081db606db5dcefdd80878d02b8659a74e7dc067d662083e2a7ed3cbf34e9191c0c22dbd6b3d042b061286d70aeffaee02112b580837733ec8bdb31fa58baf2641d280e4276f3b4d452dd94905fd93013b5f70ab72d468cf40a779d14d39226f2315262f47c2e81e91512dac499a346b3b63618cd18d1ed91d8d0d91032acafdd8ad68942c6976db862869412ef7ccb4b9e48f593c9249441b1826f2f035a347ac5c47eb8edd66e55e89f765b0ed421aa6bcf59ab4cbf9516d67719ea614b16bbea3c5f48cc07af1ed9764b6061934bc088a5b103dbab109f5dce156602e812e057d8fb114e377c5fde494015e53f0f8bed7f02574f0d839d1c6d85de3fa0ae16a2b808ebab0e57928f1ca9ddeccbfe8475fc6158e4c1c1974eca04177c2f503b6b3c561086be1334f9a122955bd0ba08539bd8afcf1d7ef6a7044d27ef911da7db47290085eedfcb8eabce56f894be393d8dd5f1b9efcd0e44358ff45bcd135b907b6e859f3c62fcc97523a0b091855bcc9484a7600229afeb9e1b8e954a1d7cd0183fa3e953701d4261470d74b357a186ddc72c1911ac7c59335fb3a8f9e17683734373547c81214bcdf142ef478a70fba843851b664680c4df792b48322173523e2a334f4016f72f59a9ea830568b4f513f8d1264c768df4c68e1eb5c8a2ac4e0aa1187580d6f745a034ec9add3145d6fb4d103aec43946f8cfd45a063889da803b4d85a5bb03a876538991c5f92c1e90f373a1598c421ff8004b84866de21d84df14a5f891f8d218b16dea3f14a3d2310ba2f9295a56dee6a8b7658e05997953fe82d13cf5eca8ccb880c5a5b0ba156ba270049886e1a4b353b04e5d3fae4610e3995e6dcfbcfe88955e3cdfb025c80ba303b5de23998e8e2c4888a5d957ec3ebe06e10d1aecab54143be7a0380a206d271cab23396a361a6a95dd3b1346456f048dce48e9dc7e3d45b168aabf19a41bd922150c48543f2efa1aaaaa6fe0160669ebaa04220a97a17d156c31bf7effe1bc6c36402b8990dcc962e9924d258adb4f5a36407a63a25341ad7a90d284947750c042e389a7f4983310cf987bd30468ff96202a80bf80a67324d48278ac5c766dc6638d6585fbbc83017ab1c352e38477fe9b2e117422ceccf7eac3884be3bf6b92ef3c35a1b49cd7bbbc17633c2d0e6c0bd3414f17f8440cdd47349d06b821311cef2c4e0c4cf9f84e4cabf743a55aac20cd37a9af87f3da4cbfd61e77bef2dde54506239a0ea470a6ef37eb28b8fe0f04bdd5591ede39401f526b40580fca879db9eb0ab7241db2fd14d7b7229beba0c58366de7a35c6f64eda9e3ccca0e5f4e7174072497d738c78579b1d71cf71735ebc846348dbe9526cddacf716b2282049850fad2b559f99ef164c81b364acfd46599cbc848e5e42ef1cdeb8295dce73712c4704b1dca917d0284ead63ed612004a92a140a303f6a68adf313cc97b083faba0ba85aca5c90210488a7f868bb4c7fd41e34aee231c7e99390975c74124d6fd24c1dd5bf8307627c6489defad9e1c448f923cb0debb911c137aebb85df4e4cb680ba8ac9433ea8fa26bde79eea18ed7f55b6b2cfcb41676da8db8fa54390bb7ee380cc3399289e16cf94ede7635e3df5d7954de448d63ca94834375b751fdabbbee1eaa685bd9e2a5115265e30b585d735274e0ab378a47dab135c0864e73e5ee127b991a1e1c856de218ec4023a91fd57404875fb854d84571b85f0b86ba1a38309475e5f69a7ae492adab4e59bc34b5e9cfd69f89692a6348c3c2cbc718a115a5bd437060783e49bbd5b580353d1da645b6a2f99ae47eb4f440d700c6c498df3ab4390176df049c87849c6f90210507f236c6810092f75ae13fd2def4e2d0c8161e0d7936d2210aefa3a581304c69cf225009632e51bc0282ce6146ffce82aa671243565816d52537d3b9b21adc2573d8dedf2217d16fafc39295929842373e51fa35f2b2f247c459573a5a2c2f738270d60232e84578ab594519e44af8f236ade57f473c50d6310d395e8b63a2bc2b32018f0a1fd32148f26a88e6a8ddd71604b48f76444d85a12ac69c10dbfd73b17e647831ac214d93eb68032e8860240bcd25822d01f6b2b55b615397db608882d423455a8b10bfb38973b2f3c303a066db0d890d10a987a4023f9ac651a27ad9c85a3791c01b441eac3a90d9d17d3fdfae5cf2696176c8b6063539fdfc7f4b23a3ad8348eb5fca2e77bfaf094255a89eae914b949e358886cef19c0143f9b94a9b95b3ad06aaeaf3fca9bc0522bc55b6ce7587503400a1c44895af9a77a5249a7a2986b7f6bd7653e7ea731dad8ed0fc62111ad3c495eea4bc71835e946818eebd9dd018aa36a890f1bdd1000b7e2e5bfebc37933ebee86aef85ccfe1e2fee2d6ddf94b1464a9f45da8e558ae3445a49e4b43482a26a15b2e6064e231e5c664eb8afaef67ba16d59d129129e1cf1595cd2194d1992f182033af52de541e48408bf140be718554ad454682d68fe4e800277ff5cd47884e16a77de09592c838e889c5e3a06831f636aecc72d6c2ec4f3903ee38f3702b6d15974d8d1fe59406d1f9a2ddd3b6cf0cc8470f7650ad084fde52a8915c920b34bcd007350e3ce36dddaf37dc7092b001d88e274a8d2c8c9f74cc69b438bca47664454951fc94f20ce56669a6bbda854373bfc87684191ca5feff111efa7cdcd53558c3231e3aee853eed6b6675db612d79dfd9161f779acc687b6329052c44d4951b992cd0d43e1417a90895fd2623e44e9a17677c14248184e4877fdcef7c9a6a5610131fc65720d7f5a9a14f34bc6ff04a088989dc3b7c086ce2a264298bb01507f6c5040a6d12fab56f303d3e56a89ff23a62c7fc243e60598915c5a71ad8f28235757af609dcb859b4b46a5258f2e6345042a7d8ce88a82b3c28e67e3e719cbb22b7c7d898be261bce756625c7f4ac8ed9448ad2bda52d7fac051aa5cb1ddc8863327f8e292ca619e077056330ea7c595fac5570a23728b0de49936f2952205e1467f6c0ab5408478a18d86236fe0994f583be4285e85cbfe0ed18e61b567b7f9bd1fc64e454bec167ce0f94a18b25091bafa6d973c8c6dd17262330e492e5d177c4a85c03b8fbc957deef3edec0941a5ddf18561829129399e6ce929c1514f1796a373d3f25186ffe25e2d488bb09d3b148d1ca4896623f7bc1cb5cb43da4f910222dcbf2440920708d37ff9f51071c9e10");
    System.out.println(decrypt);
    String verify =
        EncryptionUtils.calculateResponseVerification("1703022132432", "application/json", decrypt);
    System.out.println("Verify: " + verify);
    decrypt =
        decryptResponse(
            "1703022037130",
            "application/x-www-form-urlencoded",
            "1f5793acb6efaa6085191c59b5f4104519971246fc650ad6457da8e2a7605423adc96de6dcb681836d3e387e9a6760a413252096a799f2cb5510f042dbac5e60");
    System.out.println(decrypt);

    decrypt =
        AESUtils.decrypt(
            "74d17a55146bc5270777a028e74faa504c4d978fda02181c906a9687bc7783b9734e41b5f6cd4e81c3f4268ea52f9875baa8f853f4ed54ec84cecfa7953c6c099f631e29fbf5ca6fef45e3bc67fe6984c1a7d0e378307a69d4c22cb8842d06ae7bc5e75335243677446fa09cf606b5cc1585be2c2e26048e5392a342275b29bf5efa12df1341992f384c1a3ca03eadf09f40b09df5ad8d917e6493d9979ed3dfdd1fab3a5f3108a322e3406d770b526151802742a5e824f2335585c3d23fc34bac12236693bf6654ac176084b09d99f84b881f8fded22ba996fc286b570dc8e58369331c43e7ab7202f1b3fc72b75ac4",
            "0083ecd8eebc8b92a65debf1f0e852d5",
            "fc90d32c346d87be86c02882d1355a3b");

    System.out.println(decrypt);

    String k =
        HashUtils.md5("/oauth/token459771app")
            + "1703022036590"
            + APIConfig.CONTENT_ENCRYPTED
            + "application/x-www-form-urlencoded";
    decrypt =
        AESUtils.decrypt(
            "74d17a55146bc5270777a028e74faa504c4d978fda02181c906a9687bc7783b9734e41b5f6cd4e81c3f4268ea52f9875baa8f853f4ed54ec84cecfa7953c6c099f631e29fbf5ca6fef45e3bc67fe6984c1a7d0e378307a69d4c22cb8842d06ae7bc5e75335243677446fa09cf606b5cc1585be2c2e26048e5392a342275b29bf5efa12df1341992f384c1a3ca03eadf09f40b09df5ad8d917e6493d9979ed3dfdd1fab3a5f3108a322e3406d770b526151802742a5e824f2335585c3d23fc34bac12236693bf6654ac176084b09d99f84b881f8fded22ba996fc286b570dc8e58369331c43e7ab7202f1b3fc72b75ac4",
            HashUtils.md5(k),
            HashUtils.md5("1703022036590"));

    System.out.println(decrypt);

    decrypt =
        decryptRequest(
            "https://gateway-mg-eu.soimt.com/api.app/v1/oauth/token",
            1703022036590L,
            APIConfig.TENANT_ID,
            "",
            "74d17a55146bc5270777a028e74faa504c4d978fda02181c906a9687bc7783b9734e41b5f6cd4e81c3f4268ea52f9875baa8f853f4ed54ec84cecfa7953c6c099f631e29fbf5ca6fef45e3bc67fe6984c1a7d0e378307a69d4c22cb8842d06ae7bc5e75335243677446fa09cf606b5cc1585be2c2e26048e5392a342275b29bf5efa12df1341992f384c1a3ca03eadf09f40b09df5ad8d917e6493d9979ed3dfdd1fab3a5f3108a322e3406d770b526151802742a5e824f2335585c3d23fc34bac12236693bf6654ac176084b09d99f84b881f8fded22ba996fc286b570dc8e58369331c43e7ab7202f1b3fc72b75ac4",
            "application/x-www-form-urlencoded");

    System.out.println(decrypt);

    String encrypted =
        encryptRequest(
            "https://gateway-mg-eu.soimt.com/api.app/v1/oauth/token",
            1703022036590L,
            APIConfig.TENANT_ID,
            "",
            decrypt,
            "application/x-www-form-urlencoded");

    System.out.println(encrypted);

    decrypt =
        decryptRequest(
            "https://gateway-mg-eu.soimt.com/api.app/v1/oauth/token",
            1703022036590L,
            APIConfig.TENANT_ID,
            "",
            "74d17a55146bc5270777a028e74faa504c4d978fda02181c906a9687bc7783b9734e41b5f6cd4e81c3f4268ea52f9875baa8f853f4ed54ec84cecfa7953c6c099f631e29fbf5ca6fef45e3bc67fe6984c1a7d0e378307a69d4c22cb8842d06ae7bc5e75335243677446fa09cf606b5cc1585be2c2e26048e5392a342275b29bf5efa12df1341992f384c1a3ca03eadf09f40b09df5ad8d917e6493d9979ed3dfdd1fab3a5f3108a322e3406d770b526151802742a5e824f2335585c3d23fc34bac12236693bf6654ac176084b09d99f84b881f8fded22ba996fc286b570dc8e58369331c43e7ab7202f1b3fc72b75ac4",
            "application/x-www-form-urlencoded");

    System.out.println(decrypt);

    encrypted =
        encryptRequest(
            "https://gateway-mg-eu.soimt.com/api.app/v1/user/country/list",
            System.currentTimeMillis(), // 1703022132262L,
            APIConfig.TENANT_ID,
            "",
            null,
            "application/json");

    System.out.println(encrypted);
  }
}
